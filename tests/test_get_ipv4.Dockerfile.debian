FROM debian:stable-slim

ENV VERBOSE_LOGGING=true

COPY / /workdir/

RUN set -x && \
    apt-get update

# Test with busybox
RUN apt-get install --no-install-recommends -y busybox
RUN /workdir/helpers/get_ipv4.sh dns.google | head -1 | grep -P '^8\.8\.(8|4)\.(8|4)$'
RUN apt-get remove -y busybox

# Test with dig
RUN apt-get install --no-install-recommends -y dnsutils
RUN /workdir/helpers/get_ipv4.sh dns.google | head -1 | grep -P '^8\.8\.(8|4)\.(8|4)$'
RUN apt-get remove -y dnsutils

# Test with s6-overlay
RUN apt-get install --no-install-recommends -y \
      ca-certificates \
      curl \
      file \
      gnupg \
      && \
    curl -s https://raw.githubusercontent.com/mikenye/deploy-s6-overlay/master/deploy-s6-overlay.sh | sh
RUN /workdir/helpers/get_ipv4.sh dns.google | head -1 | grep -P '^8\.8\.(8|4)\.(8|4)$'
